
  <html>
    <head>
      <meta charset="utf-8">
      <link rel="stylesheet" media="screen" href="style.css" />
    </head>
    <body>
      <h1 id="loop">loop</h1>
<p><a href="https://travis-ci.org/criteo/loop"><img src="https://travis-ci.org/criteo/loop.svg?branch=master" alt="Build Status"></a>
<a href="https://badge.fury.io/js/devloop"><img src="https://badge.fury.io/js/devloop.svg" alt="npm version"></a>
<a href="https://david-dm.org/criteo/loop"><img src="https://david-dm.org/criteo/loop.svg" alt="Dependency Status"></a></p>
<h2 id="awesome-dev-loop-enhance-your-web-application-development-workflow">Awesome dev loop — enhance your web application development workflow</h2>
<ul>
<li><a href="#why">Why?</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#docs">Docs</a></li>
<li><a href="#examples">Examples</a></li>
<li><a href="#faq">FAQ</a></li>
<li><a href="http://github.com/criteo/loop">Github</a></li>
</ul>
<h3 id="why-">Why?</h3>
<p>Working on today&#39;s web applications requires managing several build systems. For example you will use <code>sbt</code>, <code>cargo</code>, <code>cake</code>, <code>go build</code> or <code>maven</code> to compile your backend; <code>webpack</code>, <code>grunt</code> or <code>gulp</code> to build your frontend; <code>npm</code> or <code>bower</code> to fetch some dependencies; plus a bunch of <code>sql</code> or <code>bash</code> scripts to reset your data...oh, and you have to restart your server after a change if it does not auto-reload for you.</p>
<p>If you are not using a full-stack integrated web framework that manages all that for you, your development workflow (thus your productivity) probably suffers a lot.</p>
<p><strong>loop</strong> enhances your workflow by managing all these repetitive steps. It sits in front of your application, and runs all the needed build tasks before starting your server. Then it monitors the filesystem changes, rebuilding and restarting if needed.</p>
<p>Because it is external to your project, it is agnostic to your technology choices: you can use whatever build system and setup you prefer. It just runs your build tasks and monitors the results.</p>
<p>And because everything happens in your browser, you can stay focused on your work: edit your source code, click reload in your browser and see the result!</p>
<h3 id="usage">Usage</h3>
<p><strong>loop</strong> is a command line tool that needs to be installed from npm.</p>
<h4 id="install-globally">Install globally</h4>
<pre><code>$ npm install --global devloop
</code></pre><p>And then you can use it in any project, by running the <code>loop</code> command.</p>
<h4 id="install-locally-to-a-project">Install locally to a project</h4>
<p>If you do not want to install it globally, you can also install a specific version in your project dependencies.</p>
<pre><code>$ npm install --save-dev devloop
</code></pre><p>And then use it by running the <code>node_modules/.bin/loop</code> command.</p>
<h4 id="run-the-dev-loop">Run the dev loop</h4>
<p>Run the <code>loop</code> command in any <em>looped</em> project, ie. a project that contains a <code>devloop.js</code> definition file (see the <a href="#docs">docs</a>). This file defines the tasks needed to run the project in development mode.</p>
<pre><code class="lang-javascript">$ cd my_looped_webapp/
$ loop
=&gt; Now browse to http://localhost:8080
</code></pre>
<p>You can then point your browser to <a href="http://localhost:8080">http://localhost:8080</a>. It will run the build and stream the result to the browser. Once the build is done, your server is started and your application is served.</p>
<p>If you have changed some files in your project, just reload the page in your browser. The necessary build step will be run again.</p>
<p>Pressing <code>r</code> in the terminal while <strong>loop</strong> is running will force the server task to restart. Pressing <code>x</code> will kill the current build and restart from scratch.</p>
<h3 id="docs">Docs</h3>
<p>The development tasks are described in a file named <code>devloop.js</code> located at your project root. This is a javascript file, declaring several &quot;tasks&quot; and their dependencies. There are two mandatory tasks: <code>proxy</code>, and <code>server</code>.</p>
<p>Therefore, a minimal <code>devloop.js</code> file looks like:</p>
<pre><code class="lang-javascript">&#39;use strict&#39;

let server = runServer({
  httpPort,
  sh: `python -m SimpleHTTPServer ${httpPort}`
})

proxy(server, 8080)
</code></pre>
<p>It starts the reverse proxy on port 8080, and runs the server task before serving the application.</p>
<p>Any task can also declare further dependencies, for example:</p>
<pre><code class="lang-javascript">proxy(server, 8080).dependsOn(webpack, less)
</code></pre>
<p>In this case the proxy will start serving the application when the server is ready, and the <code>webpack</code>and <code>less</code> tasks have completed as well.</p>
<p>Finally, tasks can watch the filesystem, and restart themselves if something changes. Of course, if a task restarts, all its dependencies will restart as well:</p>
<pre><code class="lang-javascript">let server = runServer({
  httpPort,
  sh: `java -cp &quot;lib/*&quot; MyServer`,
  watch: &#39;lib/**&#39;
})
</code></pre>
<p>Here, as soon as a jar file change in the lib directory, the server will be marked dirty, and will restart at the next page reload. The <code>httpPort</code> variable here is injected to the main scope by <strong>loop</strong>, and is set to a random, available TCP port. You are free to use it or not.</p>
<h5 id="proxy-servertask-httpport-">proxy(serverTask, httpPort)</h5>
<p>Starts a reverse proxy (RP) at <code>httpPort</code>. The RP will start serving the application as soon the <code>serverTask</code> and all its dependencies are ready.</p>
<h5 id="run-options-">run(options)</h5>
<p>Runs a task. A task can be any process that can be forked. <strong>loop</strong> waits for the exit status of the process, and decides whether the task was successful or not.</p>
<p>Options:</p>
<ul>
<li><code>name</code>: <em>String</em>, the task label in the UI.</li>
<li><code>sh</code>: <em>String</em>, the shell command to fork (requires Linux, MacOS, or running on Cygwin).</li>
<li><code>command</code>: <em>Array of String</em>, the command + options to fork (if not using sh).</li>
<li><code>cwd</code>: <em>String</em>, the current directory for the task.</li>
<li><code>env</code>: <em>Object</em>, the environment for the task.</li>
<li><code>watch</code>: <em>String or Array of String</em>, the file patterns to watch.</li>
</ul>
<h5 id="runserver-options-">runServer(options)</h5>
<p>Starts a <em>server</em> task. A server task is different from a standard task because <strong>loop</strong> does not wait for the process to exit to mark it as successful. Instead, it waits for the http port opened by the server process to be available.</p>
<p>Options:</p>
<ul>
<li><code>name</code>: <em>String</em>, the task label in the UI.</li>
<li><code>httpPort</code>: <em>Number</em>, the http port on which the server should listen.</li>
<li><code>sh</code>: <em>String</em>, the shell command to fork (requires Linux, MacOS, or running on Cygwin).</li>
<li><code>command</code>: <em>Array of String</em>, the command + options to fork (if not using sh).</li>
<li><code>cwd</code>: <em>String</em>, the current directory for the task.</li>
<li><code>env</code>: <em>Object</em>, the environment for the task.</li>
<li><code>watch</code>: <em>String or Array of String</em>, the file patterns to watch.</li>
</ul>
<h5 id="maven-options-">maven(options)</h5>
<p>Basically the same as using <code>run({sh: &#39;maven&#39;})</code> but colorizes the Maven output (the only advantage of using this instead of a plain <code>run</code> task).</p>
<p>Options:</p>
<ul>
<li><code>name</code>: <em>String</em>, the task label in the UI.</li>
<li><code>sh</code>: <em>String</em>, the shell command to fork (requires Linux, MacOS, or running on Cygwin).</li>
<li><code>command</code>: <em>Array of String</em>, the command + options to fork (if not using sh).</li>
<li><code>cwd</code>: <em>String</em>, the current directory for the task.</li>
<li><code>env</code>: <em>Object</em>, the environment for the task.</li>
<li><code>watch</code>: <em>String or Array of String</em>, the file patterns to watch.</li>
</ul>
<h5 id="startsbt-options-">startSbt(options)</h5>
<p>Starts a resident sbt build. This task returns an sbt session that you can use to run further sbt commands. The main advantage of using this instead of the <code>run</code> task to run sbt directly, is that the sbt session is kept alive so running the sbt commands is then way faster. Especially for <code>scalac</code> commands.</p>
<p>Options:</p>
<ul>
<li><code>name</code>: <em>String</em>, the task label in the UI.</li>
<li><code>sh</code>: <em>String</em>, the shell command to fork (requires Linux, MacOS, or running on Cygwin).</li>
<li><code>command</code>: <em>Array of String</em>, the command + options to fork (if not using sh).</li>
<li><code>cwd</code>: <em>String</em>, the current directory for the task.</li>
<li><code>env</code>: <em>Object</em>, the environment for the task.</li>
<li><code>watch</code>: <em>String or Array of String</em>, the file patterns to watch.</li>
</ul>
<p>The returned sbt session allows can then create more sbt tasks using <code>run</code> with these options:</p>
<ul>
<li><code>name</code>: <em>String</em>, the task label in the UI.</li>
<li><code>command</code>: <em>String</em>, the sbt command to run.</li>
</ul>
<h5 id="webpack-options-">webpack(options)</h5>
<p>Start a resident webpack compiler and use it to build your project. It will use the webpack module installed in your project under <code>node_modules/webpack</code>. It is way faster to use this dedicated task than forking a new <code>webpack</code> command at each build.</p>
<ul>
<li><code>name</code>: <em>String</em>, the task label in th UI (default to <em>webpack</em>).</li>
<li><code>config</code>: <em>String</em>, name of the webpack configuration file (default to <em>webpack.config.js</em>).</li>
<li><code>watch</code>: <em>String or Array of String</em>, the file patterns to watch.</li>
</ul>
<h3 id="examples">Examples</h3>
<p>Some example configurations are available in the <code>examples/</code> directory:</p>
<ul>
<li><strong>dummy-project</strong>: The &#39;Hello world&#39; for <strong>loop</strong>; just shows the basics.</li>
<li><strong>node-project</strong>: A sample node project, with some frontend assets build with webpack and stylus.</li>
<li><strong>java-project</strong>: A sample java project, with some frontend assets build with webpack and stylus.</li>
</ul>
<h3 id="faq">FAQ</h3>
<h4 id="will-loop-replace-my-build-system-">Will loop replace my build system?</h4>
<p>Not at all, <strong>loop</strong> is not another build system, it will just run your build systems for you. Think about it as a bot that will run all the commands you usually run yourself in a terminal while you are developing.</p>
<h4 id="i-use-loop-but-the-build-step-is-too-long-my-dev-workflow-was-not-improved-">I use loop, but the build step is too long. My dev workflow was not improved :(</h4>
<p>You probably need to split down your build pipeline into smaller parts. Actually, a dev build pipeline is generally different than the one you use to build the distributed version of your project. It does not mean that you have to duplicate your build; you just have to compose it from smaller parts.</p>
<h4 id="when-loop-restarts-my-server-i-m-logged-out-my-application-crashes">When loop restarts my server, I&#39;m logged out/my application crashes</h4>
<p>Yes, if you use a server that does not support automatic code reload, <strong>loop</strong> will have to restart the server process. But in a well designed application it should not log you out. There are several ways to store the session state outside of the server process (either on the client side or in a datastore which is not tied to the actual server code version). Yes, it will help your development process, but it will also help you at deployment time if you want to run your code on several application servers.</p>
<h3 id="license">License</h3>
<p>This project is licensed under the Apache 2.0 license.</p>
<h3 id="copyright">Copyright</h3>
<p>Copyright © <a href="http://labs.criteo.com">Criteo</a>, 2017.</p>

    </body>
  </html>
  